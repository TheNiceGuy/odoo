<?xml version="1.0" encoding="utf-8"?>
<odoo>

        <!-- Top menu item -->
        <menuitem id="base.menu_mrp_root"
            name="Manufacturing"
            groups="group_mrp_user,group_mrp_manager"
            icon="fa-wrench"
            web_icon="mrp,static/description/icon.png"
            sequence="35"/>

        <menuitem id="menu_mrp_manufacturing"
            name="Operations"
            parent="base.menu_mrp_root"
            sequence="10"/>

        <menuitem id="menu_mrp_planning"
            name="Planning"
            parent="base.menu_mrp_root"
            sequence="15"/>

        <menuitem id="menu_mrp_bom"
            name="Master Data"
            parent="base.menu_mrp_root"
            sequence="20"/>

        <menuitem id="menu_mrp_reporting"
              name="Reporting"
              parent="base.menu_mrp_root"
              sequence="25"/>


        <menuitem id="menu_mrp_configuration"
            name="Configuration"
            parent="base.menu_mrp_root"
            groups="group_mrp_manager,base.group_configuration"
            sequence="100"/>

        <menuitem id="menu_pm_resources_config"
            name="Resources"
            parent="menu_mrp_configuration"
            sequence="100"/>

        <menuitem id="menu_view_resource_calendar_search_mrp"
            action="resource.action_resource_calendar_form"
            parent="menu_pm_resources_config"
            sequence="10"
            groups="base.group_no_one"/>

        <menuitem id="menu_view_resource_calendar_leaves_search_mrp"
            action="resource.action_resource_calendar_leave_tree"
            parent="menu_pm_resources_config"
            sequence="20"
            groups="base.group_no_one"/>

        <!-- Property Group -->
        <record id="mrp_property_group_form_view" model="ir.ui.view">
            <field name="name">mrp.property.group.form</field>
            <field name="model">mrp.property.group</field>
            <field name="arch" type="xml">
                <form string="Properties categories">
                    <group>
                        <field name="name"/>
                    </group>
                    <separator string="Description"/>
                    <field name="description" nolabel="1"/>
                </form>
            </field>
        </record>
        <record id="mrp_property_group_action" model="ir.actions.act_window">
            <field name="name">Property Groups</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.property.group</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a group of properties.
              </p><p>
                Define specific property groups that can be assigned to your
                bill of materials and sales orders. Properties allows Odoo
                to automatically select the right bill of materials according
                to properties selected in the sales order by salesperson.
              </p><p>
                For instance, in the property group "Warranty", you an have
                two properties: 1 year warranty, 3 years warranty. Depending
                on the propoerties selected in the sales order, Odoo will
                schedule a production using the matching bill of materials.
              </p>
            </field>
        </record>
        <menuitem id="menu_mrp_property_group_action"
            action="mrp_property_group_action"
            parent="menu_mrp_configuration"
            groups="base.group_no_one,product.group_mrp_properties"
            sequence="35"/>

        <!-- Property  -->
        <record id="mrp_property_tree_view" model="ir.ui.view">
            <field name="name">mrp.property.tree</field>
            <field name="model">mrp.property</field>
            <field name="arch" type="xml">
                <tree string="Properties">
                    <field name="name"/>
                    <field name="composition"/>
                    <field name="group_id"/>
                </tree>
            </field>
        </record>
        <record id="mrp_property_form_view" model="ir.ui.view">
            <field name="name">mrp.property.form</field>
            <field name="model">mrp.property</field>
            <field name="arch" type="xml">
                <form string="Properties">
                    <group col="4">
                        <field colspan="4" name="name"/>
                        <field name="group_id"/>
                        <field name="composition"/>
                    </group>
                    <separator string="Description"/>
                    <field name="description" nolabel="1"/>
                </form>
            </field>
        </record>
        <record id="view_mrp_property_search" model="ir.ui.view">
            <field name="name">mrp.property.search</field>
            <field name="model">mrp.property</field>
            <field name="arch" type="xml">
                <search string="Search">
                    <field name="name" string="Name"/>
                    <field name="composition"/>
                    <field name="group_id" />
                    <group expand="0" string="Group By">
                        <filter string="Property Group" domain="[]" context="{'group_by':'group_id'}"/>
                    </group>
               </search>
            </field>
        </record>
        <record id="mrp_property_action" model="ir.actions.act_window">
            <field name="name">Properties</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.property</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_mrp_property_search"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a new property.
              </p><p>
                The Properties in Odoo are used to select the right bill of
                materials for manufacturing a product when you have different
                ways of building the same product.  You can assign several
                properties to each bill of materials.  When a salesperson
                creates a sales order, they can relate it to several properties
                and Odoo will automatically select the BoM to use according
                the needs.
              </p>
            </field>
        </record>
        <menuitem id="menu_mrp_property_action"
            action="mrp_property_action"
            groups="product.group_mrp_properties"
            parent="menu_mrp_configuration"
            sequence="30"/>

        <!-- Work Centers -->
        <record id="mrp_workcenter_tree_view" model="ir.ui.view">
            <field name="name">mrp.workcenter.tree</field>
            <field name="model">mrp.workcenter</field>
            <field name="arch" type="xml">
                <tree string="Work Center">
                    <field name="name"/>
                    <field name="code"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                </tree>
            </field>
        </record>
        <record id="mrp_workcenter_view" model="ir.ui.view">
            <field name="name">mrp.workcenter.form</field>
            <field name="model">mrp.workcenter</field>
            <field name="arch" type="xml">
                <form string="Work Center">
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button" name="toggle_active" type="object" icon="fa-archive">
                                <field name="active" widget="boolean_button"
                                    options='{"terminology": "archive"}'/>
                            </button>
                        </div>
                        <group>
                            <group>
                                <field name="name" string="Work Center Name"/>
                            </group>
                            <group>
                                <field name="code"/>
                                <field name="calendar_id" widget="selection"/>
                                <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="General Information">
                                <group>
                                    <group string="Capacity Information" name="capacity">
                                        <label for="time_efficiency"/>
                                        <div class="o_row">
                                            <field name="time_efficiency"/> %
                                        </div>
                                        <field name="capacity"/>
                                        <field name="time_start" widget="float_time"/>
                                        <field name="time_stop" widget="float_time"/>
                                    </group>
                                </group>
                                <separator string="Description"/>
                                <field name="note" nolabel="1" placeholder="Description of workcenter and how time/efficiency is compound..."/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="view_mrp_workcenter_search" model="ir.ui.view">
            <field name="name">mrp.workcenter.search</field>
            <field name="model">mrp.workcenter</field>
            <field name="arch" type="xml">
                <search string="Search for mrp workcenter">
                    <field name="name" string="Mrp Workcenter" filter_domain="['|',('name','ilike',self),('code','ilike',self)]"/>
                    <filter string="Archived" domain="[('active','=',False)]"/>
                    <group expand="0" string="Group By...">
                        <filter string="Company" domain="[]" context="{'group_by':'company_id'}" groups="base.group_multi_company"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Routings Workcenter -->
        <record id="mrp_routing_workcenter_tree_view" model="ir.ui.view">
            <field name="name">mrp.routing.workcenter.tree</field>
            <field name="model">mrp.routing.workcenter</field>
            <field name="arch" type="xml">
                <tree string="Routing Work Centers">
                    <field name="sequence" widget="handle"/>
                    <field name="name"/>
                    <field name="workcenter_id"/>
                    <field name="hour_nbr"/>
                    <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
                </tree>
            </field>
        </record>
        <record id="mrp_routing_workcenter_form_view" model="ir.ui.view">
            <field name="name">mrp.routing.workcenter.form</field>
            <field name="model">mrp.routing.workcenter</field>
            <field name="arch" type="xml">
                <form string="Routing Work Centers">
                    <sheet>
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="workcenter_id"/>
                                <field name="sequence" groups="base.group_no_one"/>
                            </group><group>
                                <field name="hour_nbr" widget="float_time"/>
                                <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
                            </group>
                            <group>
                                <field name="worksheet" widget="image"/>
                            </group>
                        </group>
                        <label for="note"/>
                        <field name="note"/>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="mrp_workcenter_action" model="ir.actions.act_window">
            <field name="name">Work Centers</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.workcenter</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="mrp_workcenter_tree_view"/>
            <field name="search_view_id" ref="view_mrp_workcenter_search"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to add a work center.
              </p><p>
                Work Centers allow you to create and manage manufacturing
                units. They consist of workers and/or machines, which are
                considered as units for task assignation as well as capacity
                and planning forecast.
              </p>
            </field>
        </record>

        <record id="view_mrp_production_workcenter_line_search" model="ir.ui.view">
            <field name="name">mrp.production.workcenter.line.search</field>
            <field name="model">mrp.production.workcenter.line</field>
            <field name="arch" type="xml">
                <search>
                    <field name="workcenter_id"/>
                    <filter string="Ready" name="ready" domain="[('state','=','ready')]"/>
                    <filter string="Pending" name="pending" domain="[('state','=','pause')]"/>
                    <filter string="In Progress" name="progress" domain="[('state','=','progress')]"/>
                </search>
            </field>

        </record>

        <record id="action_work_orders" model="ir.actions.act_window">
            <field name="name">Work Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production.workcenter.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,gantt,pivot,graph,calendar</field>
            <!--<field name="context">{'default_workcenter_id': }</field>-->
            <field name="search_view_id" ref="view_mrp_production_workcenter_line_search"/>
            <field name="domain">[('workcenter_id', '=', active_id), ('state', '!=', 'done')]</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to add a work center.
              </p><p>
                Work Centers allow you to create and manage manufacturing
                units. They consist of workers and/or machines, which are
                considered as units for task assignation as well as capacity
                and planning forecast.
              </p>
            </field>
        </record>

        <!-- Manufacturing Order -->
        <record id="mrp_production_tree_view" model="ir.ui.view">
            <field name="name">mrp.production.tree</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <tree decoration-bf="message_needaction==True" decoration-info="state in ('draft','confirmed')" decoration-danger="date_planned&lt;current_date and state not in ('done','cancel')" decoration-muted="state in ('done','cancel')" string="Manufacturing Orders">
                    <field name="message_needaction" invisible="1"/>
                    <field name="priority" widget="handle"/> <!-- TODO: Need to convert to integer or use sequence in order too -->
                    <field name="name"/>
                    <field name="date_planned"/>
                    <field name="product_id"/>
                    <field name="product_qty" sum="Total Qty" string="Quantity"/>
                    <field name="product_uom_id" string="Unit of Measure" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                    <field name="routing_id" groups="mrp.group_mrp_routings"/>
                    <field name="hour_total" sum="Total Hours" invisible="1"/>
                    <field name="origin"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <!-- Actions for Work Center  -->
        <record id="act_product_mrp_production_workcenter" model="ir.actions.act_window">
            <field name="context">{'search_default_planned': 1}</field>
            <field name="name">Manufacturing Orders</field>
            <field name="res_model">mrp.production</field>
            <field name="view_id" ref="mrp_production_tree_view"/>
            <field name="domain">[('routing_id', '!=', False)]</field>
        </record>


        <!-- Workcenter Kanban view-->
        <record model="ir.ui.view" id="mrp_workcenter_kanban">
            <field name="name">mrp.workcenter.kanban</field>
            <field name="model">mrp.workcenter</field>
            <field name="arch" type="xml">
                <kanban class="oe_background_grey o_kanban_dashboard o_stock_kanban" create="0">
                    <field name="name"/>
                    <field name="capacity"/>
                    <field name="time_start"/>
                    <field name="time_stop"/>
                    <field name="color"/>
                    <field name="status"/>
                    <field name="nb_orders"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="#{kanban_color(record.color.raw_value)}">
                                <div class="o_kanban_card_header">
                                    <div class="o_kanban_card_header_title">
                                        <div class="o_primary"><field name="name"/></div>
                                    </div>
                                    <div class="o_kanban_manage_button_section">
                                        <a class="o_kanban_manage_toggle_button" href="#">More <i class="fa fa-caret-down"/></a>
                                    </div>
                                </div>
                                <div class="container o_kanban_card_content o_visible">
                                    <div class="row">
                                        <div class="col-xs-6 o_kanban_primary_left">
                                            <t t-if="record.nb_orders.raw_value &gt; 0">
                                                <button class="btn btn-primary" name="%(action_work_orders)d" type="action" context="{'search_default_ready': 1, 'search_default_progress': 1}">
                                                    <span>Work Orders</span>
                                                </button>
                                            </t>
                                            <t  t-if="record.nb_orders.raw_value &lt;= 0">
                                                <button class="btn btn-warning" name="%(act_product_mrp_production_workcenter)d" type="action">
                                                <span>Plan Manufacturing</span>
                                            </button>
                                            </t>
                                        </div>
                                        <div class="col-xs-6 o_kanban_primary_right">
                                            <div class="row"><!--t-if="record.nb_alerts.raw_value > 0"-->
                                                <div class="col-xs-9">
                                                    <a name="%(action_work_orders)d" type="action" context="{'search_default_ready': 1}">
                                                        To Launch
                                                    </a>
                                                </div>
                                                <div class="col-xs-3">
                                                    <field name="count_ready_order"/>
                                                </div>
                                            </div>
                                            <div class="row"><!--t-if="record.nb_alerts.raw_value > 0"-->
                                                <div class="col-xs-9">
                                                    <a name="%(action_work_orders)d" type="action" context="{'search_default_progress': 1}">
                                                        In Progress
                                                    </a>
                                                </div>
                                                <div class="col-xs-3">
                                                    <field name="count_progress_order"/>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xs-9">
                                                    <a name="%(action_work_orders)d" type="action" context="{'search_default_pending': 1}">
                                                        Pending
                                                    </a>
                                                </div>
                                                <div class="col-xs-3">
                                                    <field name="count_pending_order"/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xs-6 o_kanban_primary_left">
                                            <div class="pull-left">
                                                <t t-if="record.status.raw_value == 'done'">
                                                    <span class="oe_kanban_status oe_kanban_status_green"/>
                                                </t>
                                                <t t-if="record.status.raw_value == 'normal'">
                                                    <span class="oe_kanban_status"/>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                </div><div class="container o_kanban_card_manage_pane o_invisible">
                                    <div class="row">
                                        <div class="col-xs-6 o_kanban_card_manage_section o_kanban_manage_view">
                                            <div class="o_kanban_card_manage_title">
                                                <span>View</span>
                                            </div>
                                            <div>
                                                <a name="%(action_work_orders)" type="action">All</a>
                                            </div>
                                        </div>
                                        <div class="col-xs-6 o_kanban_card_manage_section o_kanban_manage_new">
                                            <div class="o_kanban_card_manage_title">
                                                <span>Report</span>
                                            </div>
                                            <div>
                                                <a name="%(action_work_orders)" type="action">Work Center Efficiency</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div t-if="widget.editable" class="o_kanban_card_manage_settings row">
                                        <div class="col-xs-8">
                                            <ul class="oe_kanban_colorpicker" data-field="color"/>
                                        </div>
                                        <div class="col-xs-4 text-right">
                                            <a type="edit">Settings</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>


        <record id="mrp_workcenter_kanban_action" model="ir.actions.act_window">
            <field name="name">Dashboard</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.workcenter</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,form</field>
            <field name="search_view_id" ref="view_mrp_workcenter_search"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to add a work center.
              </p><p>
                Work Centers allow you to create and manage manufacturing
                units. They consist of workers and/or machines, which are
                considered as units for task assignation as well as capacity
                and planning forecast.
              </p>
            </field>
        </record>

        <menuitem id="menu_view_resource_search_mrp"
            action="mrp_workcenter_action"
            groups="group_mrp_routings"
            parent="menu_mrp_bom"
            sequence="100"/>
        <menuitem id="menu_mrp_dashboard"
            name="Dashboard"
            action="mrp_workcenter_kanban_action"
            groups="group_mrp_routings"
            parent="base.menu_mrp_root"
            sequence="5"/>

        <!-- Routings -->
        <record id="mrp_routing_form_view" model="ir.ui.view">
            <field name="name">mrp.routing.form</field>
            <field name="model">mrp.routing</field>
            <field name="arch" type="xml">
                <form string="Routing">
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button" name="toggle_active" type="object" icon="fa-archive">
                                <field name="active" widget="boolean_button"
                                    options='{"terminology": "archive"}'/>
                            </button>
                        </div>
                        <div class="oe_title">
                            <h1>
                                <field name="code"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="name"/>
                            </group>
                            <group>
                                <field name="location_id"/>
                                <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
                           </group>
                        </group>
                        <notebook>
                            <page string="Work Center Operations">
                                <field name="workcenter_line_ids" string="Operation"/>
                            </page>
                            <page string="Notes">
                                <field name="note"/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="mrp_routing_tree_view" model="ir.ui.view">
            <field name="name">mrp.routing.tree</field>
            <field name="model">mrp.routing</field>
            <field name="arch" type="xml">
                <tree string="Routing">
                    <field name="code"/>
                    <field name="name"/>
                    <field name="location_id"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                </tree>
            </field>
        </record>
        <record id="mrp_routing_search_view" model="ir.ui.view">
            <field name="name">mrp.routing.search</field>
            <field name="model">mrp.routing</field>
            <field name="arch" type="xml">
                <search string="Routing">
                    <field name="name" string="Routing" filter_domain="['|',('name','ilike',self),('code','ilike',self)]"/>
                    <filter string="Archived" domain="[('active','=',False)]"/>
                    <field name="location_id"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    <group expand="0" string="Group By...">
                        <filter string="Production Location" domain="[]" context="{'group_by':'location_id'}"/>
                    </group>
                </search>
            </field>
        </record>
        <record id="mrp_routing_action" model="ir.actions.act_window">
            <field name="name">Routings</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.routing</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="mrp_routing_tree_view"/>
            <field name="search_view_id" ref="mrp_routing_search_view"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a new routing.
              </p><p>
                Routings allow you to create and manage the manufacturing
                operations that should be followed within your work centers in
                order to produce a product.  They are attached to bills of
                materials that will define the required raw materials.
              </p>
            </field>
        </record>
        <menuitem id="menu_mrp_routing_action"
          action="mrp_routing_action"
          parent="menu_mrp_bom"
          groups="group_mrp_routings"
          sequence="50"/>

        <!-- Bill of Materials -->
        <record id="mrp_bom_form_view" model="ir.ui.view">
            <field name="name">mrp.bom.form</field>
            <field name="model">mrp.bom</field>
            <field name="arch" type="xml">
                <form string="Bill of Material">
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="toggle_active" type="object"
                                    class="oe_stat_button" icon="fa-archive">
                                <field name="active" widget="boolean_button"
                                    options='{"terminology": "archive"}'/>
                            </button>
                        </div>
                    <group>
                        <group>
                            <field name="product_tmpl_id"/>
                            <field name="product_id" groups="product.group_product_variant"/>
                            <label for="product_qty" string="Quantity"/>
                            <div class="o_row">
                                <field name="product_qty"/>
                                <field name="product_uom_id" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                            </div>
                            <field name="routing_id" groups="mrp.group_mrp_routings"/>
                        </group>
                        <group>
                            <field name="name"/>
                            <field name="code" string="Reference"/>
                            <field name="bom_type" widget="radio"/>
                            <p colspan="2" class="oe_grey" attrs="{'invisible': [('bom_type','=','normal')]}">
                                When processing a sales order for this product, the delivery order
                                will contain the raw materials, instead of the finished product.
                            </p>
                            <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Components">
                            <field name="bom_line_ids" widget="one2many_list">
                                <tree string="Components" editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="product_id"/>
                                    <field name="product_qty"/>
                                    <field name="product_uom_id" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                                    <field name="product_rounding" groups="mrp.group_rounding_efficiency"/>
                                    <field name="product_efficiency" groups="mrp.group_rounding_efficiency"/>
                                    <field name="attribute_value_ids" widget="many2many_tags" domain="[('product_ids.product_tmpl_id', '=', parent.product_tmpl_id)]" groups="product.group_product_variant"/>
                                    <field name="property_ids" widget="many2many_tags" groups="product.group_mrp_properties"/>
                                    <field name="operation_id" groups="mrp.group_mrp_routings" domain="[('routing_id', '=', parent.routing_id)]"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Miscellaneous">
                            <group>
                                <group>
                                    <field name="product_rounding"/>
                                    <label for="product_efficiency"/>
                                    <div class="o_row">
                                        <field name="product_efficiency"/> %
                                    </div>
                                    <field name="operation_id" domain="[('routing_id', '=', routing_id)]" groups="mrp.group_mrp_routings"/>
                                </group>
                                <group>
                                    <field name="ready_to_produce" string="Manufacturing Readiness"/>
                                    <field name="picking_type_id" string="Operation"/>
                                </group>
                            </group>
                            <separator string="Properties" groups="product.group_mrp_properties"/>
                            <group>
                                <group>
                                    <field name="property_ids" widget="many2many_tags" groups="product.group_mrp_properties"/>
                                </group>
                                <group/>
                            </group>
                        </page>
                    </notebook>
                    </sheet>
                    <div class="oe_chatter">
                         <field name="message_follower_ids" widget="mail_followers"/>
                         <field name="message_ids" colspan="4" widget="mail_thread" nolabel="1"/>
                    </div>
                </form>
            </field>
        </record>
       <record id="mrp_bom_tree_view" model="ir.ui.view">
            <field name="name">mrp.bom.tree</field>
            <field name="model">mrp.bom</field>
            <field name="arch" type="xml">
                <tree string="Bill of Materials">
                    <field name="product_tmpl_id"/>
                    <field name="code"/>
                    <field name="product_id" groups="product.group_product_variant"/>
                    <field name="product_qty"/>
                    <field name="product_uom_id" groups="product.group_uom"/>
                </tree>
            </field>
        </record>
        <record id="view_mrp_bom_filter" model="ir.ui.view">
            <field name="name">mrp.bom.select</field>
            <field name="model">mrp.bom</field>
            <field name="arch" type="xml">
                <search string="Search Bill Of Material">
                    <field name="code"/>
                    <field name="bom_line_ids" string="Components"/>
                    <field name="product_tmpl_id" string="Product"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    <filter string="Archived" name="inactive" domain="[('active','=',False)]"/>
                    <group expand="0" string="Group By...">
                        <filter string="Product" domain="[]" context="{'group_by':'product_tmpl_id'}"/>
                        <filter string='Default Unit of Measure' domain="[]" context="{'group_by' : 'product_uom_id'}"/>
                        <filter string="Routings" domain="[]" context="{'group_by':'routing_id'}"/>
                   </group>
                </search>
            </field>
        </record>
        <record id="mrp_bom_form_action" model="ir.actions.act_window">
            <field name="name">Bill of Materials</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.bom</field>
            <field name="domain">[]</field> <!-- force empty -->
            <field name="view_type">form</field>
            <field name="search_view_id" ref="view_mrp_bom_filter"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a bill of material.
              </p><p>
                Bills of Materials allow you to define the list of required raw
                materials used to make a finished product; through a manufacturing
                order or a pack of products.
              </p><p>
                Odoo uses these BoMs to automatically propose manufacturing
                orders according to procurement needs.
              </p>
            </field>
        </record>
        <menuitem id="menu_mrp_bom_form_action"
            action="mrp_bom_form_action"
            parent="menu_mrp_bom"
            sequence="99"/>

        <!-- BOM Line -->
        <record id="mrp_bom_component_tree_view" model="ir.ui.view">
            <field name="name">mrp.bom.component.tree</field>
            <field name="model">mrp.bom.line</field>
            <field name="arch" type="xml">
                <tree string="Components" editable="top">
                    <field name="sequence" widget="handle"/>
                    <field name="bom_id"/>
                    <field name="product_id"/>
                    <field name="product_qty"/>
                    <field name="product_rounding"/>
                    <field name="product_efficiency"/>
                    <field name="product_uom_id" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                    <field name="routing_id"/>
                    <field name="attribute_value_ids" widget="many2many_tags" groups="product.group_product_variant"/>
                    <field name="property_ids" widget="many2many_tags" groups="product.group_mrp_properties"/>
                </tree>
            </field>
        </record>
       <record id="mrp_bom_line_tree_view" model="ir.ui.view">
            <field name="name">mrp.bom.tree</field>
            <field name="model">mrp.bom.line</field>
            <field name="field_parent">child_line_ids</field>
            <field name="arch" type="xml">
                <tree string="Bill of Materials">
                    <field name="sequence" invisible="1"/>
                    <field name="product_id"/>
                    <field name="product_uom_id" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                    <field name="routing_id" groups="mrp.group_mrp_routings"/>
                </tree>
            </field>
        </record>
        <record id="view_mrp_bom_line_filter" model="ir.ui.view">
            <field name="name">mrp.bom.line.select</field>
            <field name="model">mrp.bom.line</field>
            <field name="arch" type="xml">
                <search string="Search Bill Of Material Components">
                    <field name="bom_id"/>
                    <field name="product_id"/>
                    <group expand="0" string="Group By...">
                        <filter string="Bill Of Material" domain="[]" context="{'group_by':'bom_id'}"/>
                        <filter string="Product" domain="[]" context="{'group_by':'product_id'}"/>
                        <filter string='Default Unit of Measure' domain="[]" context="{'group_by' : 'product_uom_id'}"/>
                        <filter string="Routings" domain="[]" context="{'group_by':'routing_id'}"/>
                   </group>
                </search>
            </field>
        </record>
        <record id="action2" model="ir.actions.act_window">
            <field name="name">Bill of Materials Structure</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.bom.line</field>
            <field name="domain">[('bom_id', 'in', active_ids)]</field>
            <field name="view_type">tree</field>
            <field name="view_id" ref="mrp_bom_line_tree_view"/>
            <field name="view_type">tree</field>
        </record>
        <record id="ir_BOM_structure" model="ir.values">
            <field eval="'client_action_multi'" name="key2"/>
            <field eval="'mrp.bom'" name="model"/>
            <field name="name">Bill of Materials Structure</field>
            <field eval="'ir.actions.act_window,'+str(action2)" name="value"/>
        </record>

        <record model="ir.actions.act_window" id="action_mrp_workorder_production_specific">
            <field name="name">Work Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production.workcenter.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,gantt,calendar,pivot,graph</field>
            <field name="domain">[('production_id', '=', active_id)]</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to start a new work order.
              </p><p>
                Work Orders is the list of operations to be performed for each
                manufacturing order. Once you start the first work order of a
                manufacturing order, the manufacturing order is automatically
                marked as started. Once you finish the latest operation of a
                manufacturing order, the MO is automatically done and the related
                products are produced.
              </p>
            </field>
        </record>

        <!-- Production Order -->
        <record id="mrp_production_form_view" model="ir.ui.view">
            <field name="name">mrp.production.form</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <form string="Manufacturing Orders">
                <header>
                    <button name="%(act_mrp_product_produce)d" attrs="{'invisible': [('availability', '=', 'none')]}" string="Produce" type="action" class="oe_highlight"/>
                    <button name="action_assign" attrs="{'invisible': [('availability', '=', 'assigned')]}" string="Check availability" type="object" class="oe_highlight"/>
                    <button name="force_assign" attrs="{'invisible': [('availability', '=', 'assigned')]}" string="Force availability" type="object"/>
                    <button name="button_plan" attrs="{'invisible': ['|', ('state', '!=', 'confirmed'), ('routing_id', '=', False)]}" type="object" string="Plan"/>
                    <button name="button_cancel" states="confirmed,planned,progress" string="Cancel Production"/>
                    <button name="button_scrap" type="object" string="Scrap" attrs="{'invisible': [('state', 'in', ('cancel'))]}"/>
                    <field name="state" widget="statusbar" statusbar_visible="confirmed,progress,done" statusbar_colors='{"confirmed":"blue"}'/>
                </header>
                <sheet>
                    <div class="oe_button_box">
                        <button name="%(action_mrp_workorder_production_specific)d" type="action" attrs="{'invisible': [('workcenter_line_ids', '=', [])]}">
                            <span class="o_stat_value"><field name="nb_done" widget="statinfo" nolabel="1"/> / <field name="nb_orders" widget="statinfo" nolabel="1"/></span><br/>
                            <span class="o_stat_text">Work Orders</span>
                        </button>
                        <field name="workcenter_line_ids" invisible="1"/>
                    </div>
                    <div class="oe_title">
                        <h1><field name="name" placeholder="Manufacturing Reference" nolabel="1"/></h1>
                    </div>
                    <group>
                        <group>
                            <field name="availability" invisible="1"/>
                            <field name="product_id" domain="[('bom_ids','!=',False),('bom_ids.bom_type','!=','phantom')]" context='{"default_type": "product"}'/>
                            <field name="product_tmpl_id" invisible="1"/>
                            <label for="product_qty"/>
                            <div class="o_row">
                                <field name="product_qty"/>
                                <field name="product_uom_id" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                                <button type="action"
                                    name="%(mrp.action_change_production_qty)d"
                                    string="Update" states="confirmed" class="oe_edit_only oe_link"/>
                            </div>
                            <field name="bom_id"
                                domain="['|',
                                            ('product_id','=',product_id),
                                            '&amp;',
                                                ('product_tmpl_id.product_variant_ids','=',product_id),
                                                ('product_id','=',False)]"
                                context="{'default_product_id': product_id, 'default_product_tmpl_id': product_tmpl_id}" required="1"/>
                            <field name="routing_id" groups="mrp.group_mrp_routings"/>
                        </group>
                        <group>
                            <field name="date_planned"/>
                            <label for="date_planned_start" string="Planned Date"/>
                            <div class="o_row">
                                <field name="date_planned_start"/>
                                <label string="to" attrs="{'invisible': [('date_planned_finished', '=', False)]}"/>
                                <field name="date_planned_finished" attrs="{'invisible': [('date_planned_start', '=', False)]}"/>
                            </div>
                            <field name="user_id"/>
                            <field name="origin"/>
                            <field name="priority" invisible="1"/>
                            <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
                            <field name="move_prod_id" groups="base.group_no_one"/>
                        </group>
                        <group groups="stock.group_locations">
                            <field name="location_src_id" domain="[('usage','=','internal')]"/>
                            <field name="location_dest_id" domain="[('usage','=','internal')]"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Consumed Materials">
                            <field name="consume_line_ids">
                                <tree editable="bottom">
                                    <field name="lots_visible" invisible="1"/>
                                    <field name="product_id"/>
                                    <field name="product_qty"/>
                                    <field name="qty_done"/>
                                    <button name="split_lot" string="Lot Split" type="object" icon="fa-list" groups="stock.group_production_lot" attrs="{'invisible': [('lots_visible', '=', False)]}"/>

                                    <field name="product_uom_id"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Finished Products">
                            <field name="move_created_ids2">
                                <field name="product_id"/>
                                <field name="restrict_lot_id"/>
                                <field name="product_uom_qty"/>
                                <field name="product_uom"/>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
                </form>
            </field>
        </record>

        <record id="mrp_production_consume_line_lot_form" model="ir.ui.view">
            <field name="name">mrp.production.consume.line.lots.form</field>
            <field name="model">mrp.production.consume.line</field>
            <field eval="20" name="priority"/>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <field name="product_id" readonly="1"/>
                        <label for="qty_done"/>
                        <span>
                            <field name="qty_done" class="oe_inline" readonly="1"/> of
                            <field name="product_qty" class="oe_inline" readonly="1"/>
                            <field name="product_uom_id" class="oe_inline" groups="product.group_uom" readonly="1"/>
                        </span>
                    </group>
                    <group>
                        <field name="production_lot_ids" nolabel="1">
                            <tree editable="bottom" decoration-success="qty_todo==qty" decoration-danger="(qty_todo &gt; 0) and (qty&gt;qty_todo)">
                                <field name="lot_id"
                                        domain="[('product_id', '=', parent.product_id)]"
                                        context="{'product_id': parent.product_id}"/>
                                <field name="qty_todo" readonly="1"/>
                                <field name="qty" invisible="context.get('serial')"/>
<!--                                 <button name="do_minus" type="object" icon="fa-minus-square"/>
                                <button name="do_plus" type="object" icon="fa-plus-square"/> -->
                                <field name="plus_visible" invisible="1"/>
                            </tree>
                        </field>
                    </group>
                    <footer>
                        <button name="save" type="object" string="Save" class="oe_highlight"/>
                        <button string="Discard" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>


        <record id="mrp_production_kanban_view" model="ir.ui.view">
            <field name="name">mrp.production.kanban</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile">
                    <field name="name"/>
                    <field name="product_id"/>
                    <field name="product_qty"/>
                     <field name="product_uom_id" options="{'no_open':True,'no_create':True}"/>
                    <field name="date_planned"/>
                    <field name="state"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                                <div class="row">
                                    <div class="col-xs-6">
                                        <strong><span><t t-esc="record.product_id.value"/></span></strong>
                                    </div>
                                    <div class="col-xs-6">
                                        <strong><span class="pull-right text-right"><t t-esc="record.product_qty.value"/> <t t-esc="record.product_uom_id.value"/></span></strong>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6 text-muted">
                                        <span><t t-esc="record.name.value"/> <t t-esc="record.date_planned.value and record.date_planned.value.split(' ')[0] or False"/></span>
                                    </div>
                                    <div class="col-xs-6">
                                        <span t-attf-class="pull-right text-right label #{['draft', 'cancel'].indexOf(record.state.raw_value) > -1 ? 'label-default' : ['none'].indexOf(record.state.raw_value) > -1 ? 'label-danger' : ['confirmed'].indexOf(record.state.raw_value) > -1 ? 'label-warning' : ['done'].indexOf(record.state.raw_value) > -1 ? 'label-success' : 'label-primary'}"><t t-esc="record.state.value"/></span>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        <record id="view_production_calendar" model="ir.ui.view">
            <field name="name">mrp.production.calendar</field>
            <field name="model">mrp.production</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar color="routing_id" date_start="date_planned" string="Manufacturing Orders">
                    <field name="name"/>
                    <field name="product_id"/>
                    <field name="product_qty"/>
                </calendar>
            </field>
        </record>
        <record id="view_production_gantt" model="ir.ui.view">
            <field name="name">mrp.production.gantt</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <gantt date_stop="date_finished" date_start="date_start" progress="progress" string="Productions" default_group_by="routing_id">
                </gantt>
            </field>
        </record>
        <record id="view_production_pivot" model="ir.ui.view">
            <field name="name">mrp.production.pivot</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <pivot string="Manufacturing Orders">
                    <field name="date_planned" type="row"/>
                    <field name="hour_total" type="measure"/>
                </pivot>
            </field>
        </record>
        <record id="view_production_graph" model="ir.ui.view">
            <field name="name">mrp.production.graph</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <graph string="Manufacturing Orders">
                    <field name="date_planned"/>
                    <field name="hour_total" type="measure"/>
                </graph>
            </field>
        </record>
        <record id="view_mrp_production_filter" model="ir.ui.view">
            <field name="name">mrp.production.select</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <search string="Search Production">
                    <field name="name" string="Production" filter_domain="['|',('name','ilike',self),('origin','ilike',self)]"/>
                    <filter string="To Do" name="todo" domain="[('state','=','confirmed')]"
                        help="Manufacturing Orders which are in draft state."/>
                    <filter string="Pending" name="pending" domain="[('state','=','confirmed')]"
                        help="Manufacturing Orders which are waiting for raw materials."/>
                    <filter string="Ready" name="ready" domain="[('state','=','ready')]"
                        help="Manufacturing Orders which are ready to start production."/>
                    <filter string="In Production" name="inprogress" domain="[('state','=','in_production')]"
                        help="Manufacturing Orders which are currently in production."/>
                    <filter string="Planned" name="planned" domain="[('state','=','planned')]"/>
                    <separator/>
                    <filter string="Late" domain="['&amp;', ('date_planned','&lt;', current_date), ('state', 'in', ('draft', 'confirmed', 'ready'))]"
                        help="Production started late"/>
                    <field name="product_tmpl_id"/>
                    <field name="product_id"/>
                    <field name="routing_id" groups="mrp.group_mrp_routings"/>
                    <group expand="0" string="Group By...">
                        <filter string="Product" domain="[]" context="{'group_by':'product_id'}"/>
                        <filter string="Routing" domain="[]" context="{'group_by':'routing_id'}"/>
                        <filter string="Status" domain="[]" context="{'group_by':'state'}"/>
                        <filter string="Scheduled Month" domain="[]" context="{'group_by':'date_planned'}" help="Scheduled Date by Month"/>
                    </group>
               </search>
            </field>
        </record>
        <record id="mrp_production_action" model="ir.actions.act_window">
            <field name="name">Manufacturing Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,kanban,form,calendar,pivot,graph,gantt</field>
            <field name="view_id" eval="False"/>
            <field name="search_view_id" ref="view_mrp_production_filter"/>
            <field name="context">{'search_default_todo': True}</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a manufacturing order.
              </p><p>
                A manufacturing order, based on a bill of materials, will
                consume raw materials and produce finished products.
              </p><p>
                Manufacturing orders are usually proposed automatically based
                on customer requirements or automated rules like the minimum
                stock rule.
              </p>
            </field>
        </record>
        <menuitem action="mrp_production_action"
            id="menu_mrp_production_action"
            parent="menu_mrp_manufacturing"
            sequence="1"/>


    <!-- Where to put production order planning??? -->

        <record id="mrp_production_action_planning" model="ir.actions.act_window">
            <field name="name">Manufacturing Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production</field>
            <field name="view_type">form</field>
            <field name="view_mode">calendar,tree,form,pivot,graph</field>
            <field name="domain">[('state','in',('ready','confirmed','in_production'))]</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to start a new manufacturing order.
              </p><p>
                A manufacturing order, based on a bill of materials, will
                consume raw materials and produce finished products.
              </p><p>
                Manufacturing orders are usually proposed automatically based
                on customer requirements or automated rules like the minimum
                stock rule.
              </p>
            </field>
        </record>

        <!-- Procurements -->
        <record id="view_procurement_rule_form_stock_inherit_mrp" model="ir.ui.view">
            <field name="name">procurement.rule.form.stock.inherit.mrp</field>
            <field name="model">procurement.rule</field>
            <field name="inherit_id" ref="stock.view_procurement_rule_form_stock_inherit"/>
            <field name="arch" type="xml">
                <field name="location_src_id" position="attributes">
                    <attribute name="attrs">{'required': [('action', '=', 'move')], 'invisible': [('action', 'not in', ['move', 'manufacture'])]}</attribute>
                </field>
            </field>
        </record>

        <record id="view_procurement_form_inherit" model="ir.ui.view">
            <field name="name">procurement.order.form.inherit</field>
            <field name="model">procurement.order</field>
            <field name="inherit_id" ref="procurement.procurement_form_view"/>
            <field name="arch" type="xml">
            <data>
                <field name="origin" position="before">
                    <field name="bom_id" domain="[('product_id','=',product_id)]"/>
                    <field name="production_id" attrs="{'invisible': [('production_id','=',False)]}"/>
                </field>
                <field name="origin" position="after">
                    <field name="property_ids" widget="many2many_tags" groups="product.group_mrp_properties"/>
                </field>
               </data>
            </field>
        </record>

        <!-- Product Template -->
        <record id="view_mrp_product_template_form_inherited" model="ir.ui.view">
            <field name="name">product.form.mrp.inherited</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="stock.view_template_property_form"/>
            <field name="arch" type="xml">
                <group name="sale_condition" position="inside">
                    <label for="produce_delay" attrs="{'invisible':[('type','=','service')]}"/>
                    <div attrs="{'invisible':[('type','=','service')]}">
                        <field name="produce_delay" class="oe_inline"/> days
                    </div>
                </group>
            </field>
        </record>
        <record id="product_template_search_view_procurment" model="ir.ui.view">
             <field name="name">product.template.search.bom</field>
             <field name="model">product.template</field>
             <field name="inherit_id" ref="product.product_template_search_view"/>
             <field name="arch" type="xml">
                 <xpath expr="//filter[@name='consumable']" position="after">
                     <separator/>
                    <filter string="Components" name="components" domain="[('bom_ids','not in',[])]"/>
                 </xpath>
             </field>
        </record>
        <record id="product_template_action" model="ir.actions.act_window">
            <field name="name">Products</field>
            <field name="res_model">product.template</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="context">{}</field>
        </record>
        <menuitem id="menu_mrp_product_form"
            name="Products"
            action="product_template_action"
            parent="menu_mrp_bom"/>

        <record id="template_open_bom" model="ir.actions.act_window">
            <field name="context">{'default_product_tmpl_id': active_id, 'search_default_product_tmpl_id': active_id}</field>
            <field name="name">Bill of Materials</field>
            <field name="res_model">mrp.bom</field>
            <field name="view_type">form</field>
        </record>
        <record id="product_template_form_view_bom_button" model="ir.ui.view">
            <field name="name">product.template.procurement</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="product.product_template_only_form_view"/>
            <field name="groups_id" eval="[(4, ref('mrp.group_mrp_user'))]"/>
            <field name="arch" type="xml">
                <div name="button_box" position="inside">
                    <button class="oe_stat_button" name="%(template_open_bom)d" type="action"
                        attrs="{'invisible':[('type', 'not in', ['product', 'consu'])]}" icon="fa-flask">
                        <field string="Bill of Materials" name="bom_count" widget="statinfo" />
                    </button>
                    <button class="oe_stat_button" name="action_view_mos" type="object"
                        attrs="{'invisible':[('type', 'not in', ['product', 'consu'])]}" icon="fa-list-alt">
                        <field string="Manufacturing" name="mo_count" widget="statinfo" />
                    </button>
                </div>
            </field>
        </record>

        <!-- Product Product -->
        <record id="product_open_bom" model="ir.actions.act_window">
            <field name="context">{'default_product_id': active_id, 'search_default_product_id': active_id}</field>
            <field name="name">Bill of Materials</field>
            <field name="res_model">mrp.bom</field>
            <field name="domain">[]</field> <!-- Force empty -->
            <field name="view_type">form</field>
        </record>
        <record id="act_product_mrp_production" model="ir.actions.act_window">
            <field name="context">{'search_default_product_id': [active_id]}</field>
            <field name="name">Manufacturing Orders</field>
            <field name="res_model">mrp.production</field>
            <field name="view_id" ref="mrp_production_tree_view"/>
        </record>

        <record id="product_product_form_view_bom_button" model="ir.ui.view">
            <field name="name">product.product.procurement</field>
            <field name="model">product.product</field>
            <field name="inherit_id" ref="product.product_normal_form_view"/>
            <field name="groups_id" eval="[(4, ref('mrp.group_mrp_user'))]"/>
            <field name="arch" type="xml">
                <div name="button_box" position="inside">
                    <button class="oe_stat_button" name="action_view_bom" type="object"
                        attrs="{'invisible':[('type', 'not in', ['product', 'consu'])]}" icon="fa-flask">
                        <field string="Bill of Materials" name="bom_count" widget="statinfo" />
                    </button>
                    <button class="oe_stat_button" name="%(act_product_mrp_production)d" type="action"
                        attrs="{'invisible':[('type', 'not in', ['product', 'consu'])]}" icon="fa-list-alt">
                        <field string="Manufacturing" name="mo_count" widget="statinfo" />
                    </button>
                </div>
            </field>
        </record>

        <!-- Warehouse -->
        <record id="view_warehouse_inherited" model="ir.ui.view">
            <field name="name">Stock Warehouse Inherited</field>
            <field name="model">stock.warehouse</field>
            <field name="inherit_id" ref="stock.view_warehouse"/>
            <field name="arch" type="xml">
                 <xpath expr="//field[@name='default_resupply_wh_id']" position="before">
                    <field name="manufacture_to_resupply" />
                </xpath>
            </field>
        </record>


        <!-- Coming from mrp_operations -->

    <record model="ir.ui.view" id="mrp_production_workcenter_tree_view_inherit">
        <field name="name">mrp.production.workcenter.line.tree</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="arch" type="xml">
            <tree string="Work Orders" decoration-success="date_planned_start&gt;=current_date and state == 'ready'" decoration-muted="state in ('done','cancel')" decoration-danger="date_planned_start&lt;current_date and state in ('draft', 'confirmed', 'ready')">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="date_planned_start"/>
                <field name="workcenter_id" widget="selection"/>
                <field name="production_id"/>
                <field name="product"/>
                <field name="qty"/>
                <field name="uom"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="mrp_production_workcenter_form_view_inherit">
        <field name="name">mrp.production.workcenter.line.form</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="arch" type="xml">
            <form string="Production Workcenter">
            <header>
                <button name="button_start" type="object" string="Start Working" attrs="{'invisible': [('state', '!=', 'pause')]}"/>
                <button name="button_start" type="object" string="Start Working" attrs="{'invisible': [('state', '!=', 'ready')]}" class="btn-success"/>
                <button name="%(act_mrp_product_produce_wo)d" type="action" string="Record Production" class="btn-success" attrs="{'invisible': ['|', ('state', '!=', 'progress'), ('show_state', '=', False)]}"/>
                <button name="button_pause" type="object" string="Pause" class="btn-warning" attrs="{'invisible': ['|', ('state', 'in', ('done', 'pause', 'ready')), ('show_state', '=', False)]}"><span>(<field name="delay" widget="float_time"/>)</span></button>
                <button name="button_finish" type="object" string="Finish Production" attrs="{'invisible': ['|',('state', '!=', 'progress'), ('check_produce_qty','=', False)]}" class="btn-info"/>
                <button name="button_start" type="object" string="Continue Production" class="btn-warning" attrs="{'invisible': ['|', ('show_state', '=', True), ('state', 'in', ('done', 'pause', 'ready'))]}"><span>(<field name="delay" widget="float_time"/>)</span></button>
                <button name="button_start" type="object" string="Continue Production" attrs="{'invisible': [('state', '!=', 'done')]}"/>
                <field name="state" widget="statusbar" statusbar_visible="pause,ready,progress,done"/>
                <field name="show_state" invisible="1"/>
                <field name="check_produce_qty" invisible="1"/>
            </header>
            <sheet>
            <group>
                <group>
                    <field name="product" string="To Produce"/>
                    <label for="qty_produced" string="Quantity Produced"/>
                    <div class="o_row">
                        <field name="qty_produced"/> /
                        <field name="qty"/>
                        <field name="uom" widget="selection"/>
                        <field name="availability" widget="bullet_state" options="{'classes': {'assigned': 'success', 'waiting': 'danger'}}"/>
                    </div>
                    <field name="sequence" invisible="1"/>
                </group>
            </group>
            <notebook>
            <page string="Work Instruction" attrs="{'invisible': [('worksheet', '=', False)]}">
                <field name="worksheet" widget="image"/>
            </page>
            <page string="Time Tracking">
                <group>
                    <group>
                        <label for="date_planned_start" string="Planned Date"/>
                        <div class="o_row">
                            <field name="date_planned_start"/>
                            <label string="to" attrs="{'invisible': [('date_planned_end', '=', False)]}"/>
                            <field name="date_planned_end" attrs="{'invisible': [('date_planned_start', '=', False)]}"/>
                        </div>
                        <label for="hour" string="Expected Duration"/>
                        <div>
                            <field name="hour" widget="float_time" class="oe_inline"/>
                            hours
                        </div>
                        <field name="capacity_planned"/>
                    </group>
                    <group>
                        <label for="date_start" string="Effective Date"/>
                        <div class="o_row">
                            <field name="date_start" readonly="1"/>
                            <label string="to" attrs="{'invisible': [('date_finished', '=', False)]}"/>
                            <field name="date_finished" readonly="1" attrs="{'invisible': [('date_start', '=', False)]}"/>
                        </div>
                        <field name="started_since" attrs="{'invisible': [('state', '!=', 'progress')]}"/>
                    </group>
                </group>
                <field name="show_state" invisible="1"/>
                <group>
                    <field name="time_ids" readonly="1" nolabel="1">
                        <tree>
                            <field name="date_start"/>
                            <field name="duration" widget="float_time"/>
                            <field name="user_id"/>
                            <field name="state"/>
                        </tree>
                        <form>
                            <group>
                                <group>
                                    <field name="date_start"/>
                                    <field name="duration" widget="float_time"/>
                                </group>
                                <group>
                                    <field name="user_id"/>
                                    <field name="state"/>
                                </group>
                            </group>
                        </form>
                    </field>
                </group>
            </page>
            <page string="Miscellaneous">
                <group>
                    <group>
                        
                    </group>
                    <group>
                        <field name="name"/>
                        <field name="workcenter_id"/>
                        <field name="production_id"/>
                    </group>
                </group>
            </page>
            </notebook>
            </sheet>
            <div class="oe_chatter">
                <field name="message_follower_ids" widget="mail_followers"/>
                <field name="message_ids" widget="mail_thread"/>
            </div>
            </form>
        </field>
    </record>

    <record id="view_mrp_production_workcenter_form_view_filter" model="ir.ui.view">
        <field name="name">mrp.production.workcenter.line.select</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="arch" type="xml">
            <search string="Search Work Orders">
                <field name="name" string="Work Orders"/>
                <field name="date_planned_start"/>
                <field name="state"/>
                <filter string="Confirmed" name="confirmed" domain="[('state','=','confirmed')]"/>
                <filter string="In Progress" name="progress" domain="[('state','=','progress')]"/>
                <filter string="Ready" name="ready" domain="[('state','=','ready')]"/>
                <filter string="Pending" name="pending" domain="[('state','=','pause')]"/>
                <filter string="Finished" name="finish" domain="[('state','=','done')]"/>
                <filter string="Available" domain="[('availability','=', 'assigned')]"/>
                <separator/>
                <filter string="Late" domain="['&amp;', ('date_planned_start','&lt;', current_date), ('state', 'in', ('draft', 'confirmed', 'ready'))]"
                    help="Production started late"/>
                <field name="workcenter_id"/>
                <field name="production_id"/>
                <group expand="0" string="Group By">
                    <filter string="Work Center" domain="[]" context="{'group_by':'workcenter_id'}"/>
                    <filter string="Production" domain="[]" context="{'group_by':'production_id'}"/>
                    <filter string="Status" domain="[]" context="{'group_by':'state'}"/>
                    <filter string="Scheduled Month" domain="[]" context="{'group_by':'date_planned_start'}" help="Scheduled Date by Month"/>
                </group>
             </search>
        </field>
    </record>

    <record id="workcenter_line_calendar" model="ir.ui.view">
        <field name="name">mrp.production.workcenter.line.calendar</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="arch" type="xml">
            <calendar color="product" date_stop="date_finished" date_start="date_start" string="Operations">
                <field name="workcenter_id"/>
                <field name="production_id"/>
            </calendar>
        </field>
    </record>

    <record id="workcenter_line_graph" model="ir.ui.view">
        <field name="name">mrp.production.workcenter.line.graph</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="arch" type="xml">
            <graph string="Operations">
                <field name="workcenter_id"/>
                <field name="production_id"/>
                <field name="qty" type="measure"/>
            </graph>
        </field>
    </record>

    <record id="workcenter_line_pivot" model="ir.ui.view">
        <field name="name">mrp.production.workcenter.line.pivot</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="arch" type="xml">
            <pivot string="Operations">
                <field name="workcenter_id"/>
                <field name="production_id"/>
                <field name="qty" type="measure"/>
            </pivot>
        </field>
    </record>


    <record id="workcenter_line_gantt_production" model="ir.ui.view">
        <field name="name">mrp.production.workcenter.line.gantt.production</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="arch" type="xml">
            <gantt date_stop="date_planned_end" date_start="date_planned_start" string="Operations" default_group_by="production_id">
            </gantt>
        </field>
    </record>

    <record id="workcenter_line_gantt_workcenter" model="ir.ui.view">
        <field name="name">mrp.production.workcenter.line.gantt.workcenter</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="arch" type="xml">
            <gantt date_stop="date_planned_end" date_start="date_planned_start" string="Operations" default_group_by="workcenter_id">
            </gantt>
        </field>
    </record>

    <record model="ir.ui.view" id="workcenter_line_kanban">
        <field name="name">mrp.production.workcenter.line.kanban</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_small_column" create="0">
                <field name="name"/>
                <field name="production_id"/>
                <field name="state"/>
                <field name="workcenter_id"/>
                <field name="product"/>
                <field name="qty"/>
                <field name="uom"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div>
                                    <span><strong><t t-esc="record.product.value"/></strong></span>
                                </div>
                                <div class="row">
                                    <div class="col-xs-7 o_kanban_primary_left">
                                        <span><t t-esc="record.qty.value"/> <t t-esc="record.uom.value"/></span>
                                    </div>
                                    <div class="col-xs-5 o_kanban_primary_right">
                                        <span><t t-esc="record.production_id.value"/></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>



    <!-- Actions for Work Orders  -->


    <record model="ir.actions.act_window" id="action_mrp_workorder_workcenter">
        <field name="name">Work Orders</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.production.workcenter.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">gantt,tree,form,calendar,pivot,graph</field>
        <field name="search_view_id" ref="view_mrp_production_workcenter_form_view_filter"/>
        <field name="view_id" ref="workcenter_line_gantt_workcenter"/>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to start a new work order.
          </p><p>
            Work Orders is the list of operations to be performed for each
            manufacturing order. Once you start the first work order of a
            manufacturing order, the manufacturing order is automatically
            marked as started. Once you finish the latest operation of a
            manufacturing order, the MO is automatically done and the related
            products are produced.
          </p>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_mrp_workorder_production">
        <field name="name">Work Orders Planning</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.production.workcenter.line</field>
        <field name="view_type">form</field>
        <!--<field name="domain">[('production_state','in',('ready','confirmed','in_production'))]</field>-->
        <field name="view_mode">gantt,tree,form,calendar,pivot,graph</field>
        <field name="view_id" ref="workcenter_line_gantt_production"/>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to start a new work order.
          </p><p>
            To manufacture or assemble products, and use raw materials and
            finished products you must also handle manufacturing operations.
            Manufacturing operations are often called Work Orders. The various
            operations will have different impacts on the costs of
            manufacturing and planning depending on the available workload.
          </p>
        </field>
    </record>

    <record model="ir.actions.act_window" id="mrp_workorder_todo">
        <field name="name">Work Orders</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.production.workcenter.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,form,calendar,pivot,graph</field>
        <field name="search_view_id" ref="view_mrp_production_workcenter_form_view_filter"/>
        <field name="context">{'search_default_confirmed': True, 'search_default_ready': True, 'search_default_progress': True}</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to start a new work order.
          </p><p>
            Work Orders is the list of operations to be performed for each
            manufacturing order. Once you start the first work order of a
            manufacturing order, the manufacturing order is automatically
            marked as started. Once you finish the latest operation of a
            manufacturing order, the MO is automatically done and the related
            products are produced.
          </p>
        </field>
    </record>



    <menuitem id="menu_mrp_workorder_todo"
            name="Work Orders"
            action="mrp_workorder_todo"
            parent="menu_mrp_manufacturing"/>

    <menuitem id="menu_mrp_production_planning"
              name="Manufacturing Orders"
              sequence="1"
              parent="menu_mrp_planning"/>

    <menuitem id="menu_mrp_production_plan"
              name="Orders to Plan"
              sequence="1"
              action="mrp_production_action_planning"
              parent="menu_mrp_production_planning"/>

    <menuitem id="menu_mrp_production_pending"
              name="Pending Orders"
              sequence="2"
              action="mrp_production_action_planning"
              parent="menu_mrp_production_planning"/>

    <menuitem id="menu_mrp_workorder_planning"
              name="Work Orders"
              sequence="2"
              parent="menu_mrp_planning"/>

    <menuitem id="menu_mrp_workorder_production"
              name="Planning by Production"
              sequence="1"
              action="action_mrp_workorder_production"
              parent="menu_mrp_workorder_planning"/>

    <menuitem id="menu_mrp_workorder_workcenter"
              name="Planning by Workcenter"
              sequence="2"
              action="action_mrp_workorder_workcenter"
              parent="menu_mrp_workorder_planning"/>


    <menuitem id="menu_mrp_mps"
          name="MPS"
          parent="menu_mrp_reporting"
          action="mrp_workorder_todo"
          sequence="5"/>

    <menuitem id="menu_mrp_traceability"
          name="Traceability"
          parent="menu_mrp_reporting"
          action="mrp_workorder_todo"
          sequence="10"/>


    <!--  Unbuild and scrap menu -->

        <record id="mrp_unbuild_search_view" model="ir.ui.view">
            <field name="name">mrp.unbuild.search</field>
            <field name="model">mrp.unbuild</field>
            <field name="arch" type="xml">
                <search string="Search">
                    <field name="product_id"/>
                    <field name="state"/>
                    <field name="mo_id"/>
                    <group expand="0" string="Filters">
                        <filter name="draft" string="Draft" domain="[('state', '=', 'draft')]"/>
                        <filter name="done" string="Done" domain="[('state', '=', 'done')]"/>
                    </group>
                    <group expand='0' string='Group by...'>
                        <filter string='Product' name="productgroup" context="{'group_by': 'product_id'}"/>
                        <filter string="Manufacturing Order" name="mogroup" context="{'group_by': 'mo_id'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record id="mrp_unbuild_form_view" model="ir.ui.view">
            <field name="name">mrp.unbuild.form</field>
            <field name="model">mrp.unbuild</field>
            <field name="arch" type="xml">
                <form string="Unbuild Orders">
                    <header>
                        <button name="button_unbuild" string="Unbuild" type="object" states="draft" class="oe_highlight"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,done" statusbar_colors="{&quot;draft&quot;:&quot;blue&quot;}"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button" name="button_produce_product"
                                    string="Produce Product" type="object" icon="fa-cog"/>
                            <field name="produce_line_ids" invisible="1"/>
                            <button class="oe_stat_button" name="button_consume_product"
                                    string="Consume Product" type="object" icon="fa-cart-plus"/>
                            <field name="consume_line_ids" invisible="1"/>
                        </div>
                        <div class="oe_title">
                            <h1><field name="name" placeholder="Unbuild Order" nolabel="1"/></h1>
                        </div>
                        <group>
                            <group>
                                <field name="product_id"/>
                                <label for="product_qty"/>
                                <div class="o_row">
                                    <field name="product_qty"/>
                                    <field name="product_uom_id" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                                </div>
                            </group>
                            <group>
                                <field name="mo_id"/>
                                <field name="location_id" groups="stock.group_locations"/>
                                <field name="lot_id"/>
                                <field name="bom_id"/>
                            </group>
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

    <record id="stock_scrap_form_view2_inherit" model="ir.ui.view">
        <field name="name">Scrap</field>
        <field name="model">stock.scrap</field>
        <field name="inherit_id" ref="stock.stock_scrap_form_view2"/>
        <field name="arch" type="xml">
            <field name="scrap_location_id" position="after">
                <field name="workorder_id"/>
            </field>
        </field>
    </record>

        <record id="mrp_unbuild_tree_view" model="ir.ui.view">
            <field name="name">mrp.unbuild.tree</field>
            <field name="model">mrp.unbuild</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="product_id"/>
                    <field name="product_qty"/>
                    <field name="bom_id"/>
                    <field name="state"/>
                    <field name="lot_id"/>
                    <field name="location_id" groups="stock.group_locations"/>
                </tree>
            </field>
        </record>

    <record model="ir.actions.act_window" id="mrp_unbuild">
        <field name="name">Unbuild Orders</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.unbuild</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_draft': True}</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to start a new Unbuild Order
          </p><p>
            Unbuild orders can be used to unbuild stuff you make. 
          </p>
        </field>
    </record>

    <menuitem id="menu_mrp_unbuild"
          name="Unbuild Orders"
          parent="menu_mrp_manufacturing"
          action="mrp_unbuild"
          sequence="20"/>

    <!-- <record model="ir.actions.act_window" id="mrp_scrap">
        <field name="name">Scrap</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">stock.scrap</field>
    </record> -->
    <menuitem id="menu_mrp_scrap"
            name="Scrap"
            parent="menu_mrp_manufacturing"
            action="stock.action_stock_scrap"
            sequence="25"/>
</odoo>
